function pad(e,t){return s="000"+e,s.substr(s.length-t)}function scrollConsole(){$cont=$("#console"),$cont[0].scrollTop=$cont[0].scrollHeight}function sendCmd(e,t){$("#gCodeLog").append('<p class="text-primary">'+e+' <span class="text-muted">; '+t+"</span></p>"),scrollConsole()}function feedback(e){$("#gCodeLog").append('<p class="text-warning">'+e+"</p>"),scrollConsole()}function start_p(){$("#stat").text("Printing"),sendCmd("M565","Start printing cache.gc"),$.ajax({url:"set?code=M565",cache:!1}).done(function(e){feedback(e)})}function cancel_p(){$("#stat").text("Canceling"),sendCmd("{P:X}","Cancel print"),$.ajax({url:"set?cmd={P:X}",cache:!1}).done(function(e){feedback(e)})}function delaySendSpeed(e){clearTimeout(timers),timers=setTimeout(function(){actualSpeed=Math.floor(255*(e/100)),sendCmd("M106 S"+actualSpeed,"Set Fan speed to "+e+"%"),$.ajax({url:"set?code=M106 S"+e,cache:!1}).done(function(e){feedback(e)})},300)}function delaySyncTemperatures(e,t){clearTimeout(timers),timers=setTimeout(function(){0!=e&&$("#wre").val(e),0!=t&&$("#wrp").val(t)},3e3)}$(document).ready(function(){sendCmd("M563 S6","Enable faster WiFi File Transfer"),$.ajax({url:"set?code=M563 S6",cache:!1}).done(function(e){feedback(e)}),setInterval(function(){$.get("inquiry",function(e,t){console.log(e),$("#rde").text(e.match(/\d+/g)[0]),$("#rdp").text(e.match(/\d+/g)[2]),delaySyncTemperatures(e.match(/\d+/g)[1],e.match(/\d+/g)[3]);var n=e.charAt(e.length-1);"I"==n?($("#stat").text("Idle"),$("#pgs").css("width","0%"),$("#gCodeSend").removeClass("btn-disable")):"P"==n?($("#stat").text("Printing"),$("#pgs").css("width",e.match(/\d+/g)[4]+"%"),$("#pgs").html(e.match(/\d+/g)[4]+"% Complete"),$("#gCodeSend").addClass("btn-disable")):$("#stat").text("N/A")})},4e3),$(".movement .home").click(function(){axis=$(this).attr("data-axis"),"all"==axis?(code="G28",comment="all axes"):(code="G28 "+axis,comment=axis+" axis"),sendCmd(code,"Home "+comment),$.ajax({url:"set?code="+code,cache:!1}).done(function(e){feedback(e)})}),$(".movement .direction button").click(function(){movement=$(this).attr("data-movement"),rate=$(".movement .rate button.active").attr("data-rate"),axis=$(this).attr("data-axis"),comment="Move "+axis,"up"!=movement&&"left"!=movement||(rate*=-1),"E"==axis&&"plus"==movement&&(comment="Extrude "),"E"==axis&&"minus"==movement&&(comment="Retract "),sendCmd("G1 "+axis+rate,comment+" "+rate+"mm"),$.ajax({url:"set?code=G91",cache:!1}).done(function(e){}),$.ajax({url:"set?code=G1 "+axis+rate,cache:!1}).done(function(e){feedback(e)})}),$(".movement .rate button").click(function(){rate=$(this).attr("data-rate"),$(".movement .rate button").removeClass("active"),$(this).addClass("active")}),$("#gCodeSend").click(function(){gCode2Send=$("#gcode").val(),""!=gCode2Send&&(sendCmd(gCode2Send,""),$.ajax({url:"set?code="+gCode2Send,cache:!1}).done(function(e){feedback(e)}),$("#gcode").val(""))}),$("#wre").change(function(){var e=pad($("#wre").val(),3);sendCmd("T0"+e,"Set Extruder Preheat to "+$("#wre").val()+"째C"),$.ajax({url:"set?cmd={C:T0"+e+"}",cache:!1}).done(function(e){feedback(e)})}),$("#sete").click(function(){var e=pad($("#wre").val(),3);sendCmd("T0"+e,"Set Extruder Preheat to "+$("#wre").val()+"째C"),$.ajax({url:"set?cmd={C:T0"+e+"}",cache:!1}).done(function(e){feedback(e)})}),$("#clre").click(function(){sendCmd("T0000","Turn off Extruder Preheat"),$.ajax({url:"set?cmd={C:T0000}",cache:!1}).done(function(e){feedback(e)})}),$("#wrp").change(function(){value=pad($("#wrp").val(),3),sendCmd("P"+value,"Set Platform Preheat to "+$("#wrp").val()+"째C"),$.ajax({url:"set?cmd={C:P"+value+"}",cache:!1}).done(function(e){feedback(e)})}),$("#setp").click(function(){value=pad($("#wrp").val(),3),sendCmd("P"+value,"Set Platform Preheat to "+$("#wrp").val()+"째C"),$.ajax({url:"set?cmd={C:P"+value+"}",cache:!1}).done(function(e){feedback(e)})}),$("#clrp").click(function(){sendCmd("P000","Turn off Platform Preheat"),$.ajax({url:"set?cmd={C:P000}",cache:!1}).done(function(e){feedback(e)})}),$("#fanspeed").slider({min:30,max:100,value:50,reversed:!0,orientation:"vertical",formatter:function(e){return e+"%"}}),$("#fanspeed").on("slide",function(e){delaySendSpeed(e.value)}),$("#clrfan").click(function(){sendCmd("M106 S0","Turn off Fan"),$.ajax({url:"set?code=M106 S0",cache:!1}).done(function(e){feedback(e)})}),$("form").submit(function(){return!1})}),String.prototype.contains=function(e){return this.indexOf(e)!=-1},Dropzone.options.mydz={dictDefaultMessage:"Upload GCode here",accept:function(e,t){e.name.contains(".g")?t():t("Not a valid GCode file.")},init:function(){this.on("error",function(e,t){var n=t.errorMessage;$(e.previewElement).find(".dz-error-message").text(n)}),this.on("addedfile",function(){null!=this.files[1]&&this.removeFile(this.files[0])})}};var timers={};