function pad(e,t){return s="000"+e,s.substr(s.length-t)}function scrollConsole(){$cont=$("#console"),$cont[0].scrollTop=$cont[0].scrollHeight}function sendCmd(e,t,n){void 0===n&&(n="code"),clearTimeout(timers),timers=setTimeout(function(){$("#gCodeLog").append('<p class="text-primary">'+e+' <span class="text-muted">; '+t+"</span></p>"),$.ajax({url:"set?"+n+"="+e,cache:!1}).done(function(e){$("#gCodeLog").append('<p class="text-warning">'+e+"</p>"),scrollConsole()}),scrollConsole()},300)}function feedback(e){$("#gCodeLog").append('<p class="text-warning">'+e+"</p>"),scrollConsole()}function start_p(){$("#stat").text("Printing"),sendCmd("M565","Start printing cache.gc")}function cancel_p(){$("#stat").text("Canceling"),sendCmd("{P:X}","Cancel print","cmd")}function delaySendSpeed(e){clearTimeout(timers),timers=setTimeout(function(){actualSpeed=Math.floor(255*(e/100)),sendCmd("M106 S"+actualSpeed,"Set fan speed to "+e+"%"),$.ajax({url:"set?code=M106 S"+e,cache:!1}).done(function(e){feedback(e)})},300)}function delaySyncTemperatures(e,t){clearTimeout(timers),timers=setTimeout(function(){0!=e&&$("#wre").val(e),0!=t&&$("#wrp").val(t)},3e3)}$(document).ready(function(){sendCmd("M563 S6","Enable faster Wi-Fi file uploads"),$.ajax({url:"set?code=G91",cache:!1}).done(),setInterval(function(){$.get("inquiry",function(e,t){console.log(e),$("#rde").text(e.match(/\d+/g)[0]),$("#rdp").text(e.match(/\d+/g)[2]),delaySyncTemperatures(e.match(/\d+/g)[1],e.match(/\d+/g)[3]);var n=e.charAt(e.length-1);"I"==n?($("#stat").text("Idle"),$("#pgs").css("width","0%"),$(".movement button").removeClass("btn-disable"),$("#gCodeSend").removeClass("btn-disable")):"P"==n?($("#stat").text("Printing"),$("#pgs").css("width",e.match(/\d+/g)[4]+"%"),$("#pgs").html(e.match(/\d+/g)[4]+"% Complete"),$(".movement button").addClass("btn-disable"),$("#gCodeSend").addClass("btn-disable")):$("#stat").text("N/A")})},3500),$(".movement .home").click(function(){axis=$(this).attr("data-axis"),"all"==axis?(code="G28 X0 Y0 Z0",comment="all axes"):(code="G28 "+axis,comment=axis+" axis"),sendCmd(code,"Home "+comment)}),$(".movement .direction button").click(function(){return command="G1 ",movement=$(this).attr("data-movement"),rate=$(".movement .rate button.active").attr("data-rate"),axis=$(this).attr("data-axis"),comment="Move "+axis,"up"!=movement&&"left"!=movement||(rate*=-1),"Z"==axis&&"down"==movement&&(comment="Raise Z "),"Z"==axis&&"up"==movement&&(comment="Lower Z "),"E"==axis&&"plus"==movement&&(comment="Extrude "),"E"==axis&&"minus"==movement?(sendCmd(command+axis+"-"+rate,"Retract "+rate+"mm"),!1):"disable"==movement?(sendCmd("M18","Disable motor lock"),!1):void sendCmd(command+axis+rate,comment+" "+rate+"mm")}),$(".movement .rate button").click(function(){rate=$(this).attr("data-rate"),$(".movement .rate button").removeClass("active"),$(this).addClass("active")}),$("#gCodeSend").click(function(){gCode2Send=$("#gcode").val(),""!=gCode2Send&&(sendCmd(gCode2Send,""),$("#gcode").val(""))}),$("#wre").change(function(){var e=pad($("#wre").val(),3);sendCmd("{C:T0"+e+"}","Set extruder preheat to "+$("#wre").val()+"째C","cmd")}),$("#sete").click(function(){var e=pad($("#wre").val(),3);sendCmd("{C:T0"+e+"}","Set extruder preheat to "+$("#wre").val()+"째C","cmd")}),$("#clre").click(function(){sendCmd("{C:T0000}","Turn off extruder preheat","cmd")}),$("#wrp").change(function(){value=pad($("#wrp").val(),3),sendCmd("{C:P"+value+"}","Set platform preheat to "+$("#wrp").val()+"째C","cmd")}),$("#setp").click(function(){value=pad($("#wrp").val(),3),sendCmd("{C:P"+value+"}","Set platform preheat to "+$("#wrp").val()+"째C","cmd")}),$("#clrp").click(function(){sendCmd("{C:P000}","Turn off platform preheat","cmd")}),$("#fanspeed").slider({min:30,max:100,value:50,reversed:!0,orientation:"vertical",formatter:function(e){return e+"%"}}),$("#fanspeed").on("slide",function(e){delaySendSpeed(e.value)}),$("#clrfan").click(function(){sendCmd("M106 S0","Turn off fan")}),$("form").submit(function(){return!1})});var timers={};String.prototype.contains=function(e){return this.indexOf(e)!=-1},Dropzone.options.mydz={dictDefaultMessage:"Upload G-code Here",accept:function(e,t){e.name.contains(".g")?t():t("Not a valid G-code file.")},init:function(){this.on("error",function(e,t){var n=t.errorMessage;$(e.previewElement).find(".dz-error-message").text(n)}),this.on("addedfile",function(){null!=this.files[1]&&this.removeFile(this.files[0])})}};